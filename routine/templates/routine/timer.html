{% extends "base.html" %}
{% load static %}

{% block title %}Timer{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'routine/css/timer.css' %}" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
{% endblock %}

{% block content %}
<div class="timer-container">
    <div id="timer-root"
        data-routine-id="{{ routine.pk }}"
        data-csrf-token="{{ csrf_token }}"
        data-routine-total="{{ total|default:0 }}">
    </div>
    <h1>Routine Timer</h1>
    
    <!-- Timer Display -->
    <div class="timer-display">
        <div class="current-task">
            <h2 id="task-name">Get Ready...</h2>
            <div class="task-duration">
                <span id="minutes">00</span>:<span id="seconds">00</span>
            </div>
        </div>
        
        <div class="progress-container">
            <div id="progress-bar" class="progress-bar"></div>
        </div>
        
        <div class="timer-info">
            <div class="info-item">
                <span class="info-label">Total Time:</span>
                <span id="total-time" class="info-value">0 minutes</span>
            </div>
            <div class="info-item">
                <span class="info-label">Tasks:</span>
                <span id="task-count" class="info-value">0 tasks</span>
            </div>
            <div class="info-item">
                <span class="info-label">Current:</span>
                <span id="current-task-number" class="info-value">{{ tasks|length|default:"0" }} tasks</span>
            </div>
        </div>
    </div>
    
    <!-- Timer Controls -->
    <div class="timer-controls">
        <button id="start-btn" class="btn btn-primary" title="Start">
            <i class="fas fa-play"></i>
            <span>Start</span>
        </button>
        <button id="pause-btn" class="btn btn-secondary" disabled title="Pause">
            <i class="fas fa-pause"></i>
            <span>Pause</span>
        </button>
        <button id="skip-btn" class="btn btn-info" disabled title="Skip">
            <i class="fas fa-forward"></i>
            <span>Skip</span>
        </button>
        <button id="reset-btn" class="btn btn-danger" disabled title="Reset">
            <i class="fas fa-redo"></i>
            <span>Reset</span>
        </button>
    </div>
    
    <!-- Upcoming Tasks -->
    <div class="upcoming-tasks">
        <h3>Upcoming Tasks</h3>
        <ul id="upcoming-tasks-list" class="tasks-list">
            <li class="empty-message">No tasks in queue</li>
        </ul>
    </div>
    
    <!-- Completed Tasks -->
    <div class="completed-tasks">
        <h3>Completed Tasks</h3>
        <ul id="completed-tasks-list" class="tasks-list">
            <li class="empty-message">No tasks completed</li>
        </ul>
    </div>
</div>
<!-- Sound files -->
<audio id="task-complete-sound" src="{% static 'sounds/slice.mp3' %}" preload="auto"></audio>
<audio id="timer-finish-sound" src="{% static 'sounds/finish.mp3' %}" preload="auto"></audio>
{% if tasks %}
{{ tasks|json_script:"routine-tasks-data" }}
{% else %}
<!-- Pass the API URL to JS using a hidden element -->
<input type="hidden" id="get-tasks-url" value="{% url 'routine:get_current_tasks' %}" />
{% endif %}
{% endblock %}
{% block extra_js %}
<script src="{% static 'routine/js/timer.js' %}"></script>
{% endblock %}